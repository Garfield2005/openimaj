<!DOCTYPE html><html xmlns:d="http://docbook.org/ns/docbook" xmlns:fo="http://www.w3.org/1999/XSL/Format">
   <head>
      <meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
   
      <title>Chapter&nbsp;11.&nbsp;Twitter Streams and Images</title>
      <link rel="stylesheet" type="text/css" href="css/apache-maven-fluido-1.3.0.min.css">
      <link rel="stylesheet" type="text/css" href="css/stylesheet.css">
      <link rel="stylesheet" type="text/css" href="fonts/fonts.css">
      <meta name="generator" content="DocBook XSL-NS Stylesheets V1.76.1">
      <link rel="home" href="index.html" title="The OpenIMAJ Tutorial">
      <link rel="up" href="pt05.html" title="Part&nbsp;V.&nbsp;Streaming Data Fundamentals">
      <link rel="prev" href="pt05.html" title="Part&nbsp;V.&nbsp;Streaming Data Fundamentals">
      <link rel="next" href="pt06.html" title="Part&nbsp;VI.&nbsp;Machine Learning Fundamentals">
      <meta property="fb:admins" content="286108206">
      <meta property="og:type" content="website">
      <link rel="image_src" href="../images/OpenImaj-sq.png">
      <meta property="og:image" content="http://openimaj.org/images/OpenImaj-sq.png">
      <meta property="og:title" content="OpenIMAJ: Open Intelligent Multimedia Analysis">
      <meta property="og:url" content="http://www.openimaj.org">
      <meta property="og:description" content="OpenIMAJ is an award-winning set of libraries and tools for multimedia content analysis and content generation."><script type="text/javascript" src="./js/apache-maven-fluido-1.3.0.min.js"></script><script type="text/javascript">
	      var _gaq = _gaq || [];
	      _gaq.push(['_setAccount', 'UA-38338744-1']);
	      _gaq.push(['_trackPageview']);

	      (function() {
	        var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
	        ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
	        var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
	      })();
	    </script></head>
   <body class="topBarEnabled">
      <div id="topbar" class="navbar navbar-fixed-top navbar-inverse">
         <div class="navbar-inner">
            <div class="container">
               <div class="nav-collapse"><a class="brand" href="../index.html" title="OpenIMAJ"><img src="images/logo-tiny.png" alt="OpenIMAJ"></a><ul class="nav">
                     <li class="dropdown"><a href="#" class="dropdown-toggle" data-toggle="dropdown">Overview <b class="caret"></b></a><ul class="dropdown-menu">
                           <li><a href="../index.html" title="Introduction">Introduction</a></li>
                           <li><a href="../sponsors.html" title="History &amp; Sponsors">History &amp; Sponsors</a></li>
                           <li><a href="../contact.html" title="Support &amp; Contacts">Support &amp; Contacts</a></li>
                           <li><a href="team.html" title="Team">Team</a></li>
                           <li><a href="http://blogs.ecs.soton.ac.uk/multimedia" title="The Blog">The Blog</a></li>
                           <li><a href="http://www.sf.net/p/openimaj/code" title="Source Code">Source Code</a></li>
                           <li class="dropdown-submenu"><a href="../#related" title="Related Projects">Related Projects</a><ul class="dropdown-menu">
                                 <li><a href="http://www.imageterrier.org/" title="ImageTerrier">ImageTerrier</a></li>
                              </ul>
                           </li>
                        </ul>
                     </li>
                     <li class="dropdown"><a href="#" class="dropdown-toggle" data-toggle="dropdown">Documentation <b class="caret"></b></a><ul class="dropdown-menu">
                           <li class="dropdown-submenu"><a href="../#gettingstarted" title="Getting Started">Getting Started</a><ul class="dropdown-menu">
                                 <li><a href="../tutorial-pdf.pdf" title="The Tutorial (PDF)">The Tutorial (PDF)</a></li>
                                 <li><a href="../tutorial/index.html" title="The Tutorial (HTML)">The Tutorial (HTML)</a></li>
                              </ul>
                           </li>
                           <li class="dropdown-submenu"><a href="../#using" title="Using OpenIMAJ">Using OpenIMAJ</a><ul class="dropdown-menu">
                                 <li><a href="../BuildFromSource.html" title="Building OpenIMAJ from Source">Building OpenIMAJ from Source</a></li>
                                 <li><a href="../UseLibrary.html" title="Using OpenIMAJ as a Library">Using OpenIMAJ as a Library</a></li>
                                 <li><a href="../Groovy.html" title="Using OpenIMAJ with Groovy">Using OpenIMAJ with Groovy</a></li>
                                 <li><a href="../tools.html" title="OpenIMAJ commandline tools introduction">OpenIMAJ commandline tools introduction</a></li>
                                 <li><a href="../flickrCrawler.html" title="The FlickrCrawler Tool">The FlickrCrawler Tool</a></li>
                                 <li><a href="../bibliography.html" title="Bibliography">Bibliography</a></li>
                              </ul>
                           </li>
                           <li><a href="../apidocs/index.html" title="API Reference">API Reference</a></li>
                           <li class="dropdown-submenu"><a href="#info" title="Project Information">Project Information</a><ul class="dropdown-menu">
                                 <li><a href="../plugin-management.html" title="Plugin Management">Plugin Management</a></li>
                                 <li><a href="../mail-lists.html" title="Mailing Lists">Mailing Lists</a></li>
                                 <li><a href="../integration.html" title="Continuous Integration">Continuous Integration</a></li>
                                 <li><a href="../license.html" title="Project License">Project License</a></li>
                                 <li><a href="../team-list.html" title="Project Team">Project Team</a></li>
                                 <li><a href="../source-repository.html" title="Source Repository">Source Repository</a></li>
                                 <li><a href="../index.html" title="About">About</a></li>
                                 <li><a href="../issue-tracking.html" title="Issue Tracking">Issue Tracking</a></li>
                                 <li><a href="../project-summary.html" title="Project Summary">Project Summary</a></li>
                                 <li><a href="../plugins.html" title="Project Plugins">Project Plugins</a></li>
                                 <li><a href="../dependency-convergence.html" title="Dependency Convergence">Dependency Convergence</a></li>
                                 <li><a href="../dependencies.html" title="Dependencies">Dependencies</a></li>
                              </ul>
                           </li>
                        </ul>
                     </li>
                     <li class="dropdown"><a href="#" class="dropdown-toggle" data-toggle="dropdown">Modules <b class="caret"></b></a><ul class="dropdown-menu">
                           <li><a href="/openimaj-maven-archetypes/index.html" title="OpenIMAJ Maven Archetypes">OpenIMAJ Maven Archetypes</a></li>
                           <li><a href="/openimaj-core-libs/index.html" title="OpenIMAJ Core Libraries">OpenIMAJ Core Libraries</a></li>
                           <li><a href="/openimaj-image/index.html" title="OpenIMAJ Image Processing Libraries">OpenIMAJ Image Processing Libraries</a></li>
                           <li><a href="/openimaj-video/index.html" title="OpenIMAJ Video Processing Libraries">OpenIMAJ Video Processing Libraries</a></li>
                           <li><a href="/openimaj-audio/index.html" title="OpenIMAJ Audio Processing Libraries">OpenIMAJ Audio Processing Libraries</a></li>
                           <li><a href="/openimaj-machine-learning/index.html" title="OpenIMAJ Machine Learning Subprojects">OpenIMAJ Machine Learning Subprojects</a></li>
                           <li><a href="/openimaj-text/index.html" title="OpenIMAJ Text Analysis Subprojects">OpenIMAJ Text Analysis Subprojects</a></li>
                           <li><a href="/thirdparty/index.html" title="OpenIMAJ Third Party Ported Libraries">OpenIMAJ Third Party Ported Libraries</a></li>
                           <li><a href="/openimaj-demos/index.html" title="OpenIMAJ Demos Subproject">OpenIMAJ Demos Subproject</a></li>
                           <li><a href="/openimaj-knowledge/index.html" title="OpenIMAJ Knowledge Representation and Reasoning Libraries">OpenIMAJ Knowledge Representation and Reasoning Libraries</a></li>
                           <li><a href="/test-resources/index.html" title="OpenIMAJ Unit Test Resources">OpenIMAJ Unit Test Resources</a></li>
                           <li><a href="/openimaj-tools/index.html" title="OpenIMAJ Tools">OpenIMAJ Tools</a></li>
                           <li><a href="/openimaj-hadoop/index.html" title="OpenIMAJ Hadoop Subproject">OpenIMAJ Hadoop Subproject</a></li>
                           <li><a href="/openimaj-storm/index.html" title="OpenIMAJ Storm Subproject">OpenIMAJ Storm Subproject</a></li>
                           <li><a href="/openimaj-web/index.html" title="OpenIMAJ web subproject">OpenIMAJ web subproject</a></li>
                           <li><a href="/openimaj-hardware/index.html" title="OpenIMAJ Hardware Subprojects">OpenIMAJ Hardware Subprojects</a></li>
                           <li><a href="/openimaj-content-libs/index.html" title="OpenIMAJ Content Creation Libraries">OpenIMAJ Content Creation Libraries</a></li>
                           <li><a href="/openimaj-ide-integration/index.html" title="OpenIMAJ IDE Integration Plugins">OpenIMAJ IDE Integration Plugins</a></li>
                           <li><a href="/openimaj-documentation/index.html" title="OpenIMAJ Documentation">OpenIMAJ Documentation</a></li>
                        </ul>
                     </li>
                  </ul>
                  <form id="search-form" action="http://www.google.com/search" method="get" class="navbar-search pull-right" name="search-form"><input value="" name="sitesearch" type="hidden"><input class="search-query" name="q" id="query" type="text"></form><script type="text/javascript" src="http://www.google.com/coop/cse/brand?form=search-form"></script><iframe src="http://www.facebook.com/plugins/like.php?href=http://www.openimaj.org/&amp;send=false&amp;layout=button_count&amp;show-faces=false&amp;action=like&amp;colorscheme=dark" scrolling="no" frameborder="0" style="border:none; width:80px; height:20px; margin-top: 10px;" class="pull-right"></iframe><script type="text/javascript" src="https://apis.google.com/js/plusone.js"></script><ul class="nav pull-right">
                     <li style="margin-top: 10px;">
                        <div class="g-plusone" data-href="http://www.openimaj.org/" data-size="medium" width="60px" align="right"></div>
                     </li>
                  </ul>
               </div>
            </div>
         </div>
      </div>
      <div class="container">
         <div id="banner">
            <div class="pull-left">
               <div id="bannerLeft">
                  <h2>OpenIMAJ</h2>
               </div>
            </div>
            <div class="pull-right"></div>
            <div class="clear">
               <hr>
            </div>
         </div>
         <div id="breadcrumbs">
            <ul class="breadcrumb">
               <li id="publishDate" class="pull-right">Last Published: 2015-02-25</li>
               <li class="divider pull-right">|</li>
               <li id="projectVersion" class="pull-right">Version: 1.4-SNAPSHOT</li>
            </ul>
         </div>
         <div id="nav-sub-block"><a class="hide" name="nav-sub-a"></a><ul id="nav-sub">
               <li class="first"><a accesskey="p" href="pt05.html"><span>Prev : Streaming Data Fundamentals</span></a></li>
               <li><a accesskey="h" href="index.html"><span>Contents</span></a></li>
               <li class="last"><a accesskey="n" href="pt06.html"><span>Next : Machine Learning Fundamentals</span></a></li>
            </ul>
         </div>
         <div class="chapter" title="Chapter&nbsp;11.&nbsp;Twitter Streams and Images">
            <div class="titlepage">
               <div>
                  <div>
                     <h2 class="title"><a name="twitter-images"></a>Chapter&nbsp;11.&nbsp;Twitter Streams and Images
                     </h2>
                  </div>
               </div>
            </div>
            	
            	
            <p>
               	  This tutorial will show you how to extract and analyse images posted
               	  on Twitter in real-time. To get started, create a new project using
               	  the OpenIMAJ archetype and in the main method, create a connection to
               	  the live Twitter sample stream as follows:
               	
            </p>
            	<pre class="programlisting">TwitterAPIToken token = DefaultTokenFactory.get(TwitterAPIToken.class);
TwitterStreamDataset stream = new TwitterStreamDataset(token);</pre>
            	<p>
               	  At this point, run the code. The first time you run it you will be
               	  instructed to register as a Twitter developer to get an API key, which
               	  you will then need to enter at the prompt. If you&#8217;ve followed the
               	  Image Datasets tutorial you should be familiar with this process from
               	  using the <code class="literal">FlickrImageDataset</code> and
               	  <code class="literal">BingImageDataset</code> classes; as with those classes you
               	  could also construct a <code class="literal">TwitterAPIToken</code> and set its
               	  fields manually. You&#8217;ll notice that not much happens other than a few
               	  debug messages. Also, notice that the program doesn&#8217;t end; this is
               	  because there is a thread running in the background reading tweets
               	  into your <code class="literal">stream</code> object. Manually stop the program
               	  running.
               	
            </p>
            	
            <p>
               	  To demonstrate that Tweets are really being added into your
               	  <code class="literal">stream</code> object, add the following code to print the
               	  text content of each Tweet and run it again:
               	
            </p>
            	<pre class="programlisting">stream.forEach(new Operation&lt;Status&gt;() {
    public void perform(Status status) {
        System.out.println(status.getText());
    }
});</pre>
            	<p>
               	  You should now see a large volume of Tweet messages being written to
               	  your console. Stop the program and remove the above
               	  <code class="literal">forEach</code> loop. We&#8217;ll now look at how we can get
               	  images out of the Tweets.
               	
            </p>
            	
            <p>
               	  Tweets themselves do not contain images; rather tweets might contain
               	  URLs, which might correspond to images, or web-sites where an image is
               	  hosted. URLs might be in the textual body of the Tweets and/or
               	  in special fields that form part of the status objects. OpenIMAJ makes
               	  it easy to extract the URLs by <span class="emphasis"><em>mapping</em></span> a stream
               	  of Twitter <code class="literal">Status</code> objects to <code class="literal">URL</code>
               	  objects:
               	
            </p>
            	<pre class="programlisting">Stream&lt;URL&gt; urlStream = stream.map(new TwitterURLExtractor());</pre>
            	<p>
               	  The <code class="literal">ImageSiteURLExtractor</code> class can be used to
               	  process the URLs and return just those that correspond to images. The
               	  <code class="literal">ImageSiteURLExtractor</code> is also aware of a number of
               	  standard image hosting sites, and is able to resolve the actual image
               	  URL from the web-page URL that would normally appear in a Tweet. The
               	  <code class="literal">ImageSiteURLExtractor</code> is just another
               	  <code class="literal">Function</code> so can be applied as another map:
               	
            </p>
            	<pre class="programlisting">Stream&lt;URL&gt; imageUrlStream = urlStream.map(new ImageSiteURLExtractor(false));</pre>
            	<p>
               	  The boolean in the <code class="literal">ImageSiteURLExtractor</code>
               	  constructor disables support for the Tumblr hosting site; you can
               	  enable it, but you&#8217;ll need to create a Tumblr API key (which you will
               	  be prompted for). Now to get the images, we can apply a static
               	  instance of function class called <code class="literal">ImageFromURL</code>
               	  which has been configured to read <code class="literal">MBFImages</code>:
               	
            </p>
            	<pre class="programlisting">Stream&lt;MBFImage&gt; imageStream = imageUrlStream.map(ImageFromURL.MBFIMAGE_EXTRACTOR);</pre>
            	<p>
               	  Now let&#8217;s display the images in the stream as they arrive:
               	
            </p>
            	<pre class="programlisting">imageStream.forEach(new Operation&lt;MBFImage&gt;() {
    public void perform(MBFImage image) {
        DisplayUtilities.displayName(image, "image");
    }
});</pre>
            	<p>
               	  If at this point you run the program, you should see be able to see
               	  the images that are currently being shared on Twitter.
               	
            </p>
            	
            <p>
               	  Now let&#8217;s modify the code so we can generate a visualisation of the
               	  <span class="emphasis"><em>faces</em></span> that appear on Twitter. Add an extra inline
               	  map function before the previous <code class="literal">forEach</code> loop, so
               	  that the code looks like this:
               	
            </p>
            	<pre class="programlisting">imageStream.map(new MultiFunction&lt;MBFImage, MBFImage&gt;() {
    public List&lt;MBFImage&gt; apply(MBFImage in) {

    }
}).forEach(new Operation&lt;MBFImage&gt;() {
    public void perform(MBFImage image) {
        DisplayUtilities.displayName(image, "image");
    }
});</pre>
            	<p>
               	  and add the following to the apply method:
               	
            </p>
            	<pre class="programlisting">List&lt;DetectedFace&gt; detected = detector.detectFaces(in.flatten());
	
List&lt;MBFImage&gt; faces = new ArrayList&lt;MBFImage&gt;();
for (DetectedFace face : detected)
    faces.add(in.extractROI(face.getBounds()));

return faces;</pre>
            	<p>
               	  and finally add the following just before the apply method:
               	
            </p>
            	<pre class="programlisting">
	HaarCascadeDetector detector = HaarCascadeDetector.BuiltInCascade.frontalface_default.load();
	</pre>
            	<p>
               	  Now, if you run the software, you should be able to to see the faces
               	  of people who are being tweeted at the current time.
               	
            </p>
            	
            <div class="sect1" title="11.1.&nbsp;Exercises">
               <div class="titlepage">
                  <div>
                     <div>
                        <h2 class="title" style="clear: both"><a name="twitter-images-exercises"></a>11.1.&nbsp;Exercises
                        </h2>
                     </div>
                  </div>
               </div>
               	  
               	  
               <div class="sect2" title="11.1.1.&nbsp;Exercise 1: The TwitterSearchStream">
                  <div class="titlepage">
                     <div>
                        <div>
                           <h3 class="title"><a name="exercise-1-search-streams"></a>11.1.1.&nbsp;Exercise 1: The TwitterSearchStream
                           </h3>
                        </div>
                     </div>
                  </div>
                  	    
                  	    
                  <p>
                     	      The <code class="code">TwitterSearchStream</code> class repeatedly calls the Twitter search API with a specific query in order to produce a stream of Tweets related to a specific
                     subject. Try using the <code class="code">TwitterSearchStream</code> to find and display tweeted images of your favourite animal.
                     	    
                  </p>
                  	  
               </div>
               	  
               <div class="sect2" title="11.1.2.&nbsp;Exercise 2: The colour of Twitter">
                  <div class="titlepage">
                     <div>
                        <div>
                           <h3 class="title"><a name="exercise-2-the-colour-of-twitter"></a>11.1.2.&nbsp;Exercise 2: The colour of Twitter
                           </h3>
                        </div>
                     </div>
                  </div>
                  	    
                  	    
                  <p>
                     	      Can you make a program that continuously shows the average colour
                     	      of the last 100 tweeted images?
                     	    
                  </p>
                  	  
               </div>
               	  
               <div class="sect2" title="11.1.3.&nbsp;Exercise 3: Trending images">
                  <div class="titlepage">
                     <div>
                        <div>
                           <h3 class="title"><a name="exercise-3-trending-images"></a>11.1.3.&nbsp;Exercise 3: Trending images
                           </h3>
                        </div>
                     </div>
                  </div>
                  	    
                  	    
                  <p>
                     	      Images are often (re)-tweeted or shared. Using the histogram
                     	      features and similarity measures you learned about in the Global
                     	      image features tutorial, can you make a program that computes
                     	      which images have been re-tweeted the most over a fixed number of
                     	      tweets?
                     	    
                  </p>
                  	  
               </div>
               	
            </div>
            
         </div>
      </div>
      <div id="nav-sub-block" class="bottom"><a class="hide" name="nav-sub-a"></a><ul id="nav-sub">
            <li class="first"><a accesskey="p" href="pt05.html"><span>Prev : Streaming Data Fundamentals</span></a></li>
            <li><a accesskey="h" href="index.html"><span>Contents</span></a></li>
            <li class="last"><a accesskey="n" href="pt06.html"><span>Next : Machine Learning Fundamentals</span></a></li>
         </ul>
      </div>
      <footer>
         <div class="container">
            <div class="row span12">Copyright &copy; 2011-2014 <a href="http://www.soton.ac.uk">The University of Southampton</a>. All Rights Reserved.
                 				
            </div>
            <p id="poweredBy" class="pull-right"><a href="http://maven.apache.org/" title="Built by Maven" class="poweredBy"><img class="builtBy" alt="Built by Maven" src="./images/logos/maven-feather.png"></a></p>
            <div id="ohloh" class="pull-right"><script type="text/javascript" src="http://www.ohloh.net/p/openimaj/widgets/project_partner_badge.js"></script></div>
         </div>
      </footer>
   </body>
</html>